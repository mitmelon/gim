var general = new General;
const BASE = general.getBase();

$(window).on('load', function () {
  var sessionCode = storage.get('gimSessionCode');

  if ($('.register').length) {
    new TomSelect("#select-countries", {
      create: true,
      sortField: {
        field: "text",
        direction: "asc"
      }
    });
  }

  $(document).on("submit", ".signin", function (e) {
    e.preventDefault();
    var formData = new FormData(this);
    var button = $('#login').html();
    formData.append('fingerprint', radar._Tracker().deviceFingerPrint);
    formData.append('request', general.getCurrentUrl());
    general.ajaxFormData('.signin', 'POST', BASE + 'src/Processor/Auth/login.php', formData, '#login', button, function (data) {
      $('#login').removeClass("btn-dim");
      $('#login').attr('disabled', true);
      $('#login').attr('style', 'opacity: 0.5');
      document.querySelector('#login').style.pointerEvents = "none";
      $('#login').html('Redirecting...');
      setTimeout(() => {
        general.reload();
      }, 3000);
      general.redirect(data.url);
      return;
    });
  });

  $(document).on("submit", ".register", function (e) {
    e.preventDefault();
    var formData = new FormData(this);
    var button = $('#letsgouser').html();
    formData.append('fingerprint', radar._Tracker().deviceFingerPrint);
    general.ajaxFormData('.register', 'POST', BASE + 'src/Processor/Auth/register.php', formData, '#letsgouser', button, function (data) {
      gToast.success(data.message);
      $('#letsgouser').removeClass("btn-dim");
      $('#letsgouser').attr('disabled', true);
      $('#letsgouser').attr('style', 'opacity: 0.5');
      document.querySelector('#letsgouser').style.pointerEvents = "none";
      $('#letsgouser').html('Redirecting...');
      setTimeout(function () {
        general.redirect('index');
      }, 4000);
    });
  });




  $(document).on("submit", ".forgotPassword", function (e) {
    e.preventDefault();
    var button = $('#reset').html();
    var formData = new FormData(this);
    formData.append('login_payload', login_payload);
    formData.append('fingerprint', radar._Tracker().deviceFingerPrint);
    general.ajaxFormData('.forgotPassword', 'POST', BASE + 'src/Processor/Auth/Forgot.php', formData, '#reset', button, function (data) {
      gToast.success(data.message);
    });
  });


});

if (document.getElementsByClassName('MAnchors_').length) {
  var tracking = document.getElementsByClassName('MAnchors_');
  var tracker = new Anchor;
  tracker.events = ['click', 'dblclick', 'touchstart', 'onmouseover'];
  tracker.endpoint = BASE + 'src/Processor/Misc/Anchor.php';
  for (const tt of tracking) {
    tracker.init(tt);
  }
}